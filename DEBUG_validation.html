<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Validation Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-label.required::after {
            content: " *";
            color: #dc3545;
            font-weight: bold;
        }
        
        .form-control.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        .invalid-feedback {
            display: block;
            color: #dc3545;
        }
        
                 .form-label.error {
             color: #dc3545;
             font-weight: bold;
         }
         
         .progress-bar.very-weak {
             background-color: #dc3545;
         }
         
         .progress-bar.weak {
             background-color: #fd7e14;
         }
         
         .progress-bar.medium {
             background-color: #ffc107;
         }
         
         .progress-bar.strong {
             background-color: #28a745;
         }
         
         .progress-bar.very-strong {
             background-color: #20c997;
         }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2>Debug Validation Test</h2>
        
        <form id="registrationForm">
            <div id="errorSummary" class="alert alert-danger mb-3" style="display: none;"></div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="firstName" class="form-label required">First Name</label>
                    <input type="text" class="form-control" id="firstName" name="firstName">
                    <div class="invalid-feedback" id="firstNameError"></div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="lastName" class="form-label required">Last Name</label>
                    <input type="text" class="form-control" id="lastName" name="lastName">
                    <div class="invalid-feedback" id="lastNameError"></div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="email" class="form-label required">Email Address</label>
                <input type="email" class="form-control" id="email" name="email">
                <div class="invalid-feedback" id="emailError"></div>
            </div>
            
            <div class="mb-3">
                <label for="confirmEmail" class="form-label required">Confirm Email Address</label>
                <input type="email" class="form-control" id="confirmEmail" name="confirmEmail">
                <div class="invalid-feedback" id="confirmEmailError"></div>
            </div>
            
            <div class="mb-3">
                <label for="companyName" class="form-label required">Company Name</label>
                <input type="text" class="form-control" id="companyName" name="companyName">
                <div class="invalid-feedback" id="companyNameError"></div>
            </div>
            
                         <div class="mb-3">
                 <label for="password" class="form-label required">Password</label>
                 <input type="password" class="form-control" id="password" name="password">
                 <div class="progress mt-2" style="height: 8px;">
                     <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                 </div>
                 <div class="form-text" id="passwordStrengthText">Password strength: Very Weak</div>
                 <div class="form-text" id="passwordRequirements">
                     <small>Requirements: 12+ characters, uppercase, lowercase, number, symbol</small>
                 </div>
                 <div class="invalid-feedback" id="passwordError"></div>
             </div>
            
            <div class="mb-3">
                <label for="confirmPassword" class="form-label required">Confirm Password</label>
                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
                <div class="invalid-feedback" id="confirmPasswordError"></div>
            </div>
            
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="terms" name="terms">
                <label class="form-check-label required" for="terms">
                    I agree to the Terms of Service and Privacy Policy
                </label>
                <div class="invalid-feedback" id="termsError"></div>
            </div>
            
            <button type="submit" class="btn btn-primary">Test Validation</button>
        </form>
        
        <div id="debug" class="mt-3 p-3 bg-light">
            <h4>Debug Info:</h4>
            <div id="debugOutput"></div>
        </div>
    </div>

         <script>
         function debugLog(message) {
             const debugOutput = document.getElementById('debugOutput');
             debugOutput.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
         }
         
         // Password strength functions
         function checkPasswordStrength(password) {
             let score = 0;
             let requirements = [];
             
             // Length check
             if (password.length >= 12) {
                 score += 2;
             } else {
                 requirements.push('12+ characters');
             }
             
             // Character type checks
             if (/[A-Z]/.test(password)) {
                 score += 1;
             } else {
                 requirements.push('uppercase letter');
             }
             
             if (/[a-z]/.test(password)) {
                 score += 1;
             } else {
                 requirements.push('lowercase letter');
             }
             
             if (/\d/.test(password)) {
                 score += 1;
             } else {
                 requirements.push('number');
             }
             
             if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) {
                 score += 1;
             } else {
                 requirements.push('symbol');
             }
             
             return { score, requirements };
         }
         
         function updatePasswordStrength() {
             const password = document.getElementById('password').value;
             const strengthBar = document.getElementById('passwordStrengthBar');
             const strengthText = document.getElementById('passwordStrengthText');
             const requirements = document.getElementById('passwordRequirements');
             
             if (!password) {
                 strengthBar.style.width = '0%';
                 strengthBar.className = 'progress-bar';
                 strengthText.textContent = 'Password strength: Very Weak';
                 requirements.innerHTML = '<small>Requirements: 12+ characters, uppercase, lowercase, number, symbol</small>';
                 return;
             }
             
             const { score, requirements: missingRequirements } = checkPasswordStrength(password);
             
             let strength, width, colorClass;
             
             if (score === 0) {
                 strength = 'Very Weak';
                 width = '10%';
                 colorClass = 'very-weak';
             } else if (score <= 2) {
                 strength = 'Weak';
                 width = '25%';
                 colorClass = 'weak';
             } else if (score <= 3) {
                 strength = 'Medium';
                 width = '50%';
                 colorClass = 'medium';
             } else if (score <= 4) {
                 strength = 'Strong';
                 width = '75%';
                 colorClass = 'strong';
             } else {
                 strength = 'Very Strong';
                 width = '100%';
                 colorClass = 'very-strong';
             }
             
             strengthBar.style.width = width;
             strengthBar.className = `progress-bar ${colorClass}`;
             strengthText.textContent = `Password strength: ${strength}`;
             
             if (missingRequirements.length > 0) {
                 requirements.innerHTML = `<small>Missing: ${missingRequirements.join(', ')}</small>`;
             } else {
                 requirements.innerHTML = '<small class="text-success">âœ“ All requirements met!</small>';
             }
             
             debugLog('Password strength updated: ' + strength + ' (score: ' + score + ')');
         }
         
         function checkPasswordMatch() {
             const password = document.getElementById('password').value;
             const confirmPassword = document.getElementById('confirmPassword').value;
             const confirmField = document.getElementById('confirmPassword');
             const confirmError = document.getElementById('confirmPasswordError');
             
             if (confirmPassword && password !== confirmPassword) {
                 confirmField.classList.add('is-invalid');
                 confirmError.textContent = 'Passwords do not match';
                 confirmError.style.display = 'block';
                 debugLog('Password confirmation failed');
             } else if (confirmPassword) {
                 confirmField.classList.remove('is-invalid');
                 confirmField.classList.add('is-valid');
                 confirmError.style.display = 'none';
                 debugLog('Password confirmation passed');
             }
         }

        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            debugLog('Form submitted');
            
            // Clear previous errors
            clearErrors();
            
            // Get form data
            const formData = new FormData(this);
            const firstName = formData.get('firstName').trim();
            const lastName = formData.get('lastName').trim();
            const email = formData.get('email').trim();
            const confirmEmail = formData.get('confirmEmail').trim();
            const companyName = formData.get('companyName').trim();
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            const terms = formData.get('terms');
            
            debugLog('Form data collected: firstName=' + firstName + ', lastName=' + lastName + ', email=' + email);
            
            let errors = [];
            let errorFields = [];
            
            // Validate First Name
            if (!firstName) {
                debugLog('First name validation failed');
                showError('firstName', 'First name is required');
                errors.push('First Name');
                errorFields.push('firstName');
            }
            
            // Validate Last Name
            if (!lastName) {
                debugLog('Last name validation failed');
                showError('lastName', 'Last name is required');
                errors.push('Last Name');
                errorFields.push('lastName');
            }
            
            // Validate Company Name
            if (!companyName) {
                debugLog('Company name validation failed');
                showError('companyName', 'Company name is required');
                errors.push('Company Name');
                errorFields.push('companyName');
            }
            
            // Validate Email
            if (!email) {
                debugLog('Email validation failed');
                showError('email', 'Email address is required');
                errors.push('Email Address');
                errorFields.push('email');
            } else {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    debugLog('Email format validation failed');
                    showError('email', 'Please enter a valid email address');
                    errors.push('Email Address');
                    errorFields.push('email');
                }
            }
            
            // Validate Confirm Email
            if (!confirmEmail) {
                debugLog('Confirm email validation failed');
                showError('confirmEmail', 'Please confirm your email address');
                errors.push('Confirm Email Address');
                errorFields.push('confirmEmail');
            } else if (email !== confirmEmail) {
                debugLog('Email confirmation validation failed');
                showError('confirmEmail', 'Email addresses do not match');
                errors.push('Confirm Email Address');
                errorFields.push('confirmEmail');
            }
            
            // Validate Password
            if (!password) {
                debugLog('Password validation failed');
                showError('password', 'Password is required');
                errors.push('Password');
                errorFields.push('password');
            } else {
                // Check password strength according to specification: 12 characters, symbol, upper, lower, number
                const hasUpperCase = /[A-Z]/.test(password);
                const hasLowerCase = /[a-z]/.test(password);
                const hasNumbers = /\d/.test(password);
                const hasSymbols = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
                const hasMinLength = password.length >= 12;
                
                debugLog('Password check: length=' + password.length + ', upper=' + hasUpperCase + ', lower=' + hasLowerCase + ', number=' + hasNumbers + ', symbol=' + hasSymbols);
                
                if (!hasMinLength || !hasUpperCase || !hasLowerCase || !hasNumbers || !hasSymbols) {
                    debugLog('Password strength validation failed');
                    showError('password', 'Password must be at least 12 characters with uppercase, lowercase, number, and symbol');
                    errors.push('Password');
                    errorFields.push('password');
                }
            }
            
            // Validate Confirm Password
            if (!confirmPassword) {
                debugLog('Confirm password validation failed');
                showError('confirmPassword', 'Please confirm your password');
                errors.push('Confirm Password');
                errorFields.push('confirmPassword');
            } else if (password !== confirmPassword) {
                debugLog('Password confirmation validation failed');
                showError('confirmPassword', 'Passwords do not match');
                errors.push('Confirm Password');
                errorFields.push('confirmPassword');
            }
            
            // Validate Terms
            if (!terms) {
                debugLog('Terms validation failed');
                showError('terms', 'You must agree to the Terms of Service and Privacy Policy');
                errors.push('Terms of Service agreement');
                errorFields.push('terms');
            }
            
            debugLog('Total errors found: ' + errors.length);
            
            // Show error summary if there are errors
            if (errors.length > 0) {
                debugLog('Showing error summary');
                showErrorSummary(errors);
                return;
            }
            
                         debugLog('All validation passed');
             alert('All fields are valid!');
         });
         
         // Add event listeners for real-time validation
         document.addEventListener('DOMContentLoaded', function() {
             const passwordField = document.getElementById('password');
             const confirmPasswordField = document.getElementById('confirmPassword');
             
             // Password strength real-time updates
             passwordField.addEventListener('input', updatePasswordStrength);
             
             // Password confirmation real-time updates
             passwordField.addEventListener('input', checkPasswordMatch);
             confirmPasswordField.addEventListener('input', checkPasswordMatch);
             
             debugLog('Event listeners added for real-time password validation');
         });
        
        function showError(fieldName, message) {
            debugLog('showError called for: ' + fieldName + ' - ' + message);
            const field = document.getElementById(fieldName);
            const errorDiv = document.getElementById(fieldName + 'Error');
            const label = field.previousElementSibling;
            
            if (field && errorDiv) {
                field.classList.add('is-invalid');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                // Make label red
                if (label && label.classList.contains('required')) {
                    label.classList.add('error');
                    debugLog('Label made red for: ' + fieldName);
                }
            } else {
                debugLog('ERROR: Field or errorDiv not found for: ' + fieldName);
            }
        }
        
        function clearErrors() {
            debugLog('clearErrors called');
            const fields = ['firstName', 'lastName', 'email', 'confirmEmail', 'companyName', 'password', 'confirmPassword', 'terms'];
            
            fields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                const errorDiv = document.getElementById(fieldName + 'Error');
                const label = field.previousElementSibling;
                
                if (field) {
                    field.classList.remove('is-invalid');
                }
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                }
                if (label) {
                    label.classList.remove('error');
                }
            });
            
            document.getElementById('errorSummary').style.display = 'none';
        }
        
        function showErrorSummary(errors) {
            debugLog('showErrorSummary called with ' + errors.length + ' errors');
            const summary = document.getElementById('errorSummary');
            summary.innerHTML = `
                <strong>Please correct the following ${errors.length} error${errors.length > 1 ? 's' : ''}:</strong>
                <ul class="mb-0 mt-2">
                    ${errors.map(error => `<li>${error}</li>`).join('')}
                </ul>
            `;
            summary.style.display = 'block';
        }
    </script>
</body>
</html>
